{% extends "base.html" %}
{% load static %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/prescription/prescription_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container prescription-container colorful-style" dir="ltr" id="prescription-content">
  <!-- ğŸ’§ Watermark -->
  <div class="watermark">
    <img src="{% static 'images/heart_logo.png' %}" alt="Watermark">
  </div>

  <!-- ğŸŒˆ Colorful Header -->
  <div class="doctor-header-vibrant">
    <div class="logo-box-rounded">
      <img src="{% static 'images/heart_logo.png' %}" alt="Logo" class="heart-logo">
    </div>
    <div class="doctor-info">
      <h2 class="doctor-name">Ø¯. {{ prescription.doctor.user.get_full_name }}</h2>
      <p class="doctor-name-en">Dr. {{ prescription.doctor.user.get_full_name }}</p>
      <p class="degree">M.B.Ch.B. â€“ ABHS (Medicine)</p>
      <p class="specialization">
        Ø§Ø®ØªØµØ§Øµ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨ÙŠØ© ÙˆØ§Ù„ØªÙ†ÙØ³ÙŠØ© ÙˆØ§Ù„Ù‡Ø¶Ù…ÙŠØ©ØŒ Ø§Ù„Ø¶ØºØ·ØŒ Ø§Ù„ÙƒÙ„Ù‰ØŒ ÙÙ‚Ø± Ø§Ù„Ø¯Ù…ØŒ Ø§Ù„Ø³ÙƒØ±ÙŠØŒ Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©<br>
        Specialist in Cardiology, Respiratory, Digestive, Hypertension, Kidney, Anemia, Diabetes, Thyroid
      </p>
      <div class="membership">
        <strong>âš•ï¸ Medical Syndicate ID:</strong> {{ prescription.doctor.medical_syndicate_id|default:"â€”" }}<br>
        <strong>Joined:</strong> {{ prescription.doctor.user.date_joined|date:"d/m/Y" }}
      </div>
    </div>
    <div class="dna-badge">ğŸ§¬</div>
  </div>

  <!-- ğŸ“ Patient Info -->
  <div class="info-line" dir="rtl">
    <div><strong>ğŸ‘¤ Name:</strong> {{ prescription.patient_full_name }}</div>
    <div><strong>ğŸ‚ Age:</strong> {{ prescription.age }} years</div>
    <div><strong>ğŸ“… Date:</strong> {{ prescription.date_issued|date:"Y-m-d H:i" }}</div>
  </div>

  <!-- ğŸ’Š Prescription Section -->
  <div class="prescription-card">
    <h5 class="text-gradient">ğŸ§¾ Prescription</h5>
    <ul class="list-unstyled">
      {% for med in prescription.medications.all %}
        <li class="mb-2">â€¢ {{ med.name }} â€” {{ med.dosage }}</li>
      {% empty %}
        <li class="mb-2">â€¢ No medications prescribed.</li>
      {% endfor %}
    </ul>
    {% if prescription.instructions %}
      <p><strong>ğŸ“‹ Instructions:</strong> {{ prescription.instructions }}</p>
    {% endif %}
  </div>

  <hr class="my-4">

  <!-- ğŸ§ Voice Note -->
  {% if prescription.voice_note %}
    <div class="audio-section d-print-none">
      <h6>ğŸ§ Doctorâ€™s Voice Note:</h6>
      <div class="custom-audio-player">
        <audio controls>
          <source src="{{ prescription.voice_note.url }}" type="{{ prescription.voice_note.file.content_type }}">
          Your browser does not support the audio element.
        </audio>
      </div>
    </div>
    <hr class="my-4">
  {% endif %}

  <!-- âœï¸ Signature Section -->
  <div class="signature-area">
    <p><strong>âœï¸ Signature:</strong></p>
    {% if prescription.doctor_signature %}
      <img src="{{ prescription.doctor_signature.url }}" alt="Doctor Signature" class="img-fluid">
    {% else %}
      <p class="text-muted">No signature uploaded</p>
    {% endif %}
  </div>

  <!-- ğŸ“¦ QR Code -->
  {% if prescription.qr_code %}
    <div class="text-center mt-4">
      <h6 class="text-primary">ğŸ” Scan QR to verify this prescription</h6>
      <img src="{{ prescription.qr_code.url }}" alt="QR Code" class="img-fluid" style="max-width: 160px;">
    </div>
  {% endif %}

  <!-- ğŸ“ Contact -->
  <div class="footer-contact mt-4">
    <p><strong>ğŸ“</strong> 07803724699</p>
    <p><strong>ğŸ“</strong> Ø§Ù„Ø³ÙŠØ¯ÙŠØ© â€“ Ø§Ù„Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ â€“ Ø±ÙƒÙ† Ø´Ø§Ø±Ø¹ Ø§Ù„ØµÙ†Ø§Ø¹Ø© â€“ Ù…Ø¬Ù…Ø¹ Ø®Ø· Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø·Ø¨ÙŠ</p>
    <p><strong>ğŸ“</strong> Al-Saydiya â€“ Commercial St â€“ Al-Hayat Medical Complex</p>
  </div>

  <!-- ğŸ“… Follow-up Note -->
  <div class="follow-up-note text-center mt-4">
    <p class="fw-bold text-danger">ğŸ•“ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù… Ù…Ø¹ Ø¬Ù„Ø¨ Ø§Ù„ÙˆØµÙØ©</p>
  </div>

  <!-- ğŸ”˜ Action Buttons -->
  <div class="d-print-none text-center mt-3">
    <button onclick="window.print()" class="btn btn-outline-primary">ğŸ–¨ï¸ Print</button>
    <a href="{% url 'prescription:send_whatsapp' prescription.pk %}" class="btn btn-success">ğŸ“¤ WhatsApp</a>
  </div>
</div>
{% endblock %}
