{% extends "base.html" %}
{% load static %}

{% block extra_head %}
  <!-- Custom CSS for Create Appointment -->
  <link rel="stylesheet" href="{% static 'css/appointments/create_appointment.css' %}">
  <!-- Secretary Form Styling -->
  <link rel="stylesheet" href="{% static 'css/appointments/appointment_form.css' %}">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
<div class="container py-5">

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="card shadow-lg rounded-4 appointment-form-card">
    <div class="card-header bg-primary text-white text-center py-4 rounded-top-4">
      <h3 class="mb-0">
        <i class="bi bi-calendar-plus"></i> Book New Appointment
      </h3>
    </div>

    <div class="card-body p-4">
      <form method="post" action="{% url 'appointments:create_appointment' %}" novalidate class="patient-form">
        {% csrf_token %}

        {% if form.errors %}
          <div class="alert alert-danger">
            <strong>Please correct the errors below:</strong>
            <ul class="mb-0 mt-2">
              {% for field in form %}
                {% for error in field.errors %}
                  <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <div class="row g-4">
          <!-- Patient -->
          <div class="col-md-6">
            <label for="{{ form.patient.id_for_label }}" class="form-label">Select Patient</label>
            {{ form.patient }}
          </div>

          <!-- Doctor -->
          <div class="col-md-6">
            <label for="{{ form.doctor.id_for_label }}" class="form-label">Select Doctor</label>
            {{ form.doctor }}
          </div>

          <!-- Scheduled Time -->
          <div class="col-md-6">
            <label for="{{ form.scheduled_time.id_for_label }}" class="form-label">Appointment Time</label>
            {{ form.scheduled_time }}
          </div>

          <!-- Status -->
          <div class="col-md-6">
            <label for="{{ form.status.id_for_label }}" class="form-label">Appointment Status</label>
            {{ form.status }}
          </div>

          <!-- IQD Amount -->
          <div class="col-md-6">
            <label for="{{ form.iqd_amount.id_for_label }}" class="form-label">Amount (IQD)</label>
            {{ form.iqd_amount }}
          </div>

          <!-- Notes -->
          <div class="col-12">
            <label for="{{ form.notes.id_for_label }}" class="form-label">Notes (Optional)</label>
            {{ form.notes }}
          </div>
        </div>

        <div class="text-center mt-5">
          <button type="submit" class="btn btn-success px-4 py-2 shadow">
            <i class="bi bi-check-circle-fill me-2"></i>
            Confirm Appointment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
  <!-- Flatpickr JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      flatpickr(".datetimepicker", {
        enableTime: true,
        noCalendar: false,
        dateFormat: "Y-m-d h:i K",
        time_24hr: false
      });
    });
  </script>
{% endblock %}
